---
title: "Corona-19 from Jan-22 to Feb-26"
author: ""
output:
  github_document:
    toc: yes
    toc_depth: 4
  word_document: default
  html_document:
    highlight: textmate
    toc: yes
    toc_depth: 4
    toc_float: yes
---  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=F, message=F, warning=F, cache=F)
```  

```{r echo=FALSE}
setwd("D:\\공모전\\2019-coronavirus-dataset-01212020-01262020")
```  

```{js, echo=FALSE}
$(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show Source</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show Output</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show Plot</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
```  


```{css, echo=FALSE}
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 100px;
  height: 20px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
```  

## Libraries  

```{r include=FALSE}
library(data.table)
library(tidyverse)
library(lubridate) # to manipulate Date class
library(stringr)
library(scales)   # for using scale_x_date


library(DT)
library(plotly)
library(treemap)  # for drawing treemap
library(viridis) # nice color palette
library(RColorBrewer) # for color palettes
library(purrr) # for mapping over a function
library(magick) # this is call to animate/read pngs

library(shiny)
library(rgeos)
library(maps)
library(maptools)
library(leaflet)   # interative map
```  


```{r eval=FALSE}
library(data.table)
library(tidyverse)
library(lubridate) # to manipulate Date class
library(stringr)
library(scales)   # for using scale_x_date

library(DT)
library(plotly)
library(treemap)  # for drawing treemap

library(rgeos)
library(maps)
library(maptools)
library(leaflet)   # interative map
```  



## Dataset  

<div class="fold s">
```{r}
full_table <-fread("covid_19_clean_complete.csv", data.table = F)
```  
</div>  

## Preprocessing

### Cleaning Data  

<div class="fold s">
```{r}
full_table$`Country/Region` <- str_replace(full_table$`Country/Region`,'Mainland China','China')

# filling missing values with NA
full_table$`Province/State`[full_table$`Province/State`==""] <- NA
full_table$index <- 1:nrow(full_table)
```  
</div>  

<div class="fold s">
```{r results='markup'}
full_table$Date <- str_replace(full_table$Date,"2002","2020")
full_table$Date <- gsub(pattern = "-20$", replacement = "-02",x = full_table$Date)

datatable(full_table, caption = "Table : test data",
          filter = 'top', options = list(pageLength = 10, autoWidth = TRUE))
```
</div>
[View the full_table](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/full_table.html)  

```{r echo=FALSE}
DT::saveWidget(datatable(full_table, caption = "Table : test data",
                         filter = 'top', options = list(pageLength = 10, autoWidth = TRUE)),
               "full_table.html")
```

 
<div class="fold s">
```{r}
temp<-full_table %>% filter(str_length(full_table$Date)==10)
temp2<-full_table %>% filter(str_length(full_table$Date)!=10)


temp$Date<-ydm(temp$Date)
temp2$Date<-mdy(temp2$Date)
```  
</div>  

<div class="fold s">
```{r}
full_table<-rbind(temp,temp2) %>% arrange(index)
```  
</div>  


### Derived Tables  


<div class="fold s">
```{r}
`%notin%` <- Negate(`%in%`)  # user function

ship <- full_table  %>% filter(`Province/State`=="Diamond Princess cruise ship")
full_table <- full_table %>% filter(full_table$index %notin% ship$index)
# full_table <- full_table %>% filter(!(full_table$index %in% ship$index))


china <- full_table %>% filter(`Country/Region`=="China") 
row <- full_table %>% filter(`Country/Region`!="China") 


full_latest <- full_table %>% filter(full_table$Date==max(full_table$Date))
china_latest <- full_latest %>% filter(full_latest$`Country/Region`=="China")
row_latest <- full_latest %>% filter(full_latest$`Country/Region`!="China")

full_latest_grouped <- full_latest %>% 
  group_by(`Country/Region`) %>% 
  summarise(Confirmed = sum(Confirmed),
            Deaths = sum(Deaths),
            Recovered = sum(Recovered))

china_latest_grouped <- china_latest %>% 
  group_by(`Province/State`) %>% 
  summarise(Confirmed = sum(Confirmed),
            Deaths = sum(Deaths),
            Recovered = sum(Recovered))

row_latest_grouped <- row_latest %>% 
  group_by(`Country/Region`) %>% 
  summarise(Confirmed = sum(Confirmed),
            Deaths = sum(Deaths),
            Recovered = sum(Recovered))
```  
</div>  


<div class="fold s">
```{r}
tmp<- full_table %>% 
      group_by(Date) %>% 
      summarise(Confirmed = sum(Confirmed),
                Deaths = sum(Deaths),
                Recovered = sum(Recovered)) %>% 
      arrange(Date)

tmp %>% tail(1) %>% data.frame
```  
</div>  


### Complete Data  


<div class="fold s">
```{r}
tmp<-full_latest %>% 
  group_by(`Country/Region`, `Province/State`) %>% 
  summarise(Confirmed = max(Confirmed),
            Deaths = max(Deaths),
            Recovered = max(Recovered))

datatable(tmp, caption = "Table : test data",
          filter = 'top', options = list(pageLength = 10, autoWidth = TRUE))
```  
</div>  
[View the Complete Data](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/completedata.html)  

```{r echo=FALSE}
DT::saveWidget(datatable(tmp, caption = "Table : test data",
                         filter = 'top', options = list(pageLength = 10, autoWidth = TRUE)),
               "completedata.html")
```



### Country Wise Latest Data  


<div class="fold s">
```{r}
tmp<-full_latest_grouped %>% 
  arrange(-Confirmed)
  
datatable(tmp, caption = "Table : test data",
          filter = 'top', options = list(pageLength = 10, autoWidth = TRUE))
```
</div>  
[View the Country wise latest data](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/country_wise_latest_data.html)  



```{r echo=FALSE}
DT::saveWidget(datatable(tmp, caption = "Table : test data",
                         filter = 'top', options = list(pageLength = 10, autoWidth = TRUE)),
               "country_wise_latest_data.html")
```


### Chines Province Wise Latest Data  


<div class="fold s">
```{r}
tmp <- china_latest_grouped %>% 
  arrange(-Confirmed)

datatable(tmp, caption = "Table : test data",
          filter = 'top', options = list(pageLength = 10, autoWidth = TRUE))
```
</div>  
[View the Chines Province Wise Latest Data](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/chinese_province_wise_latest_data.html)  


```{r echo=FALSE}
DT::saveWidget(datatable(tmp, caption = "Table : test data",
                         filter = 'top', options = list(pageLength = 10, autoWidth = TRUE)),
               "chinese_province_wise_latest_data.html")
```


## Map  


### Reported cases over the world  

<div class="fold s">
```{r}
# World wide - except for ship

full_latest_Hubei<-full_latest %>% filter(`Province/State` %in% "Hubei")
full_latest_other<-full_latest %>% filter(`Province/State` %notin% "Hubei")


mnpopup1 <- paste0("<li>Country: ", as.character(full_latest_other$`Country/Region`), "<br>",
                   "<li>Province: ", as.character(full_latest_other$`Province/State`), "<br>",
                   "<li>ConFirmed: ", as.character(full_latest_other$Confirmed), "<br>",
                   "<li>Deaths: ", as.character(full_latest_other$Deaths), "<br>",
                   "<li>Recovered: ", as.character(full_latest_other$Recovered), "<br>")

mnpopup2 <- paste0("<li>Country: ", as.character(full_latest_Hubei$`Country/Region`), "<br>",
                   "<li>Country: ", as.character(full_latest_Hubei$`Province/State`), "<br>",
                   "<li>ConFirmed: ", as.character(full_latest_Hubei$Confirmed), "<br>",
                   "<li>Deaths: ", as.character(full_latest_Hubei$Deaths), "<br>",
                   "<li>Recovered: ", as.character(full_latest_Hubei$Recovered), "<br>")


labs1 <- lapply(seq(nrow(full_latest_other)), function(i) {
  paste0( '<b>',"Country: ","</b>" , full_latest_other[i, "Country/Region"], '<br>', 
          '<b>',"Province: ","</b>" , full_latest_other[i, "Province/State"], '<br>',
          '<b>',"ConFirmed: ","</b>" , full_latest_other[i, "Confirmed"], '<br>',
          '<b>',"Deaths: ","</b>", full_latest_other[i, "Deaths"], '<br>', 
          '<b>',"Recovered: ","</b>", full_latest_other[i, "Recovered"],'<br>') 
})

labs2 <- lapply(seq(nrow(full_latest_Hubei)), function(i) {
  paste0( '<b>',"Country: ","</b>" , full_latest_Hubei[i, "Country/Region"], '<br>', 
          '<b>',"Province: ","</b>" , full_latest_Hubei[i, "Province/State"], '<br>',
          '<b>',"ConFirmed: ","</b>" , full_latest_Hubei[i, "Confirmed"], '<br>',
          '<b>',"Deaths: ","</b>", full_latest_Hubei[i, "Deaths"], '<br>', 
          '<b>',"Recovered: ","</b>", full_latest_Hubei[i, "Recovered"],'<br>') 
})




leaflet(data=full_latest) %>% addTiles() %>%  
  
  addCircleMarkers(data=full_latest_other,
                   ~Long, ~Lat, 
                   popup = mnpopup1, label = lapply(labs1, htmltools::HTML),
                   radius = ~Confirmed/300, color="blue") %>% 
  
  addCircleMarkers(data = full_latest_Hubei,
                   ~Long, ~Lat, 
                   popup = mnpopup2, label = lapply(labs2, htmltools::HTML),
                   radius = ~Confirmed/8000, color = "red")
```
</div>  
[View the Reported cases over the world map](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/all_over_map.html)  



### Reported cases in China  

<div class="fold s">
```{r}
china_latest_other<-china_latest %>% filter(`Province/State`!="Hubei")
china_latest_Hubei<-china_latest %>% filter(`Province/State`=="Hubei")



mnpopup1 <- paste0("<b>","Province: ","</b>", as.character(china_latest_other$`Province/State`), "<br>",
                   "<b>","ConFirmed: ","</b>", as.character(china_latest_other$Confirmed), "<br>",
              "<b>", "Deaths: ", "</b>", as.character(china_latest_other$Deaths), "<br>",
              "<b>", "Recovered: ", "</b>", as.character(china_latest_other$Recovered), "<br>")

mnpopup2 <- paste0("<b>","Province: ","</b>", as.character(china_latest_Hubei$`Province/State`), "<br>",
                   "<b>","ConFirmed: ","</b>", as.character(china_latest_Hubei$Confirmed), "<br>",
              "<b>", "Deaths: ", "</b>", as.character(china_latest_Hubei$Deaths), "<br>",
              "<b>", "Recovered: ", "</b>", as.character(china_latest_Hubei$Recovered), "<br>")


labs1 <- lapply(seq(nrow(china_latest_other)), function(i) {
  paste0( '<b>',"Province: ","</b>" , china_latest_other[i, "Province/State"], '<br>',
          '<b>',"ConFirmed: ","</b>" , china_latest_other[i, "Confirmed"], '<br>', 
          '<b>',"Deaths: ","</b>", china_latest_other[i, "Deaths"], '<br>', 
          '<b>',"Recovered: ","</b>", china_latest_other[i, "Recovered"],'<br>') 
})

labs2 <- lapply(seq(nrow(china_latest_Hubei)), function(i) {
  paste0( '<b>',"Province: ","</b>" , china_latest_Hubei[i, "Province/State"], '<br>',
          '<b>',"ConFirmed: ","</b>" , china_latest_Hubei[i, "Confirmed"], '<br>', 
          '<b>',"Deaths: ","</b>", china_latest_Hubei[i, "Deaths"], '<br>', 
          '<b>',"Recovered: ","</b>", china_latest_Hubei[i, "Recovered"],'<br>') 
})






leaflet(data=china_latest) %>% addTiles() %>% 
  setView(109, lat=38, zoom = 4 ) %>% 
  
  addCircleMarkers(data=china_latest_other,
                   ~Long, ~Lat, 
                   popup = mnpopup1, label = lapply(labs1, htmltools::HTML),
                   radius = ~Confirmed/140, color="blue") %>% 
  
  addCircleMarkers(data = china_latest_Hubei,
                   ~Long, ~Lat, 
                   popup = mnpopup2, label = lapply(labs2, htmltools::HTML),
                   radius = ~Confirmed/3000, color = "red")
```
</div>  
[View the Reported cases in China map](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/china_map.html)  

In here, i didn't use the below map. just refer.  
[Download the world map](http://thematicmapping.org/downloads/world_borders.php)  

### Cases in differnt Countries  

<div class="fold s">
```{r}
# ## map - search!!
# getwd()
# 
# library(rgdal)
# myspdf<-readOGR(dsn = getwd(),layer="TM_WORLD_BORDERS_SIMPL-0.3")
# head(myspdf)
# summary(myspdf)
# 
# head(myspdf@data)
# 
# 
# pal <- colorNumeric(
#   palette = "Blues",
#   domain = full_latest_grouped$Confirmed)
# 
# qpal <- colorQuantile("Blues", full_latest$Confirmed, n = length(full_latest$Confirmed))
# paletteLayers <- colorBin(palette = "blue", domain = c(full_latest_grouped$Confirmed), 
#                           bins = c(0, 0.2, 0.4, 0.6, .8, 1) , pretty=FALSE)
# 
# leaflet(data = myspdf) %>%
#   addTiles() %>%
#   addPolygons(stroke = FALSE, smoothFactor = 0.2, fillOpacity = 0.6,
#     color = ~paletteLayers(full_latest_grouped$Confirmed))
# ??paletteLayers
```  
</div>  

<div class="fold s">
```{r}
temp <- full_table %>% group_by(`Country/Region`, Date) %>% summarise(Confirmed=sum(Confirmed),
                                                                      Deaths=sum(Deaths),
                                                                      Recovered=sum(Recovered))

fig1 <- temp %>%
        ggplot(aes(x=Date, y=Confirmed, fill=`Country/Region`)) +
        geom_bar(stat = "identity") +
        ggtitle("Cases")


ggplotly(fig1, dynamicTicks = T)
```
</div>  

[View the Cases in differnt Countries - Cases](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/case_in_difference_country.html)  

```{r echo=FALSE}
DT::saveWidget(ggplotly(fig1, dynamicTicks = T),
               "case_in_difference_country.html")
```  


<div class="fold s">
```{r}
fig2 <- temp %>% 
        ggplot(aes(x=Date, y=Deaths, color=`Country/Region`)) + 
        geom_bar(stat="identity") +
        ggtitle("Deaths")

ggplotly(fig2, dynamicTicks = T)
```
</div>  

[View the Cases in different Countrires - Deaths](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/case_in_difference_country2.html)  

```{r echo=FALSE}
DT::saveWidget(ggplotly(fig2, dynamicTicks = T),
               "case_in_difference_country2.html")
```  


<div class="fold s">
```{r}
temp <- full_latest_grouped %>% 
  dplyr::select(`Country/Region`, Deaths) %>%
  arrange(-Deaths) %>% 
  filter(Deaths>0)


temp %>% data.frame
```  
</div>  

### Spread over the time  

<div class="fold s">
```{r}
pal <- colorNumeric(palette = colorRampPalette(c("blue", "red"))(10),
                    domain = 0:max(china$Confirmed))
#-------------


ui <- bootstrapPage(
  tags$style(type = "text/css", "html, body {width:100%;height:100%}"),
  absolutePanel(top = 50, 
                right = 100,
                draggable = T,
                style="z-index:500;",
                sliderInput("animation", "Time:",
                            "Time of data collection:",
                            min = min(china$Date),
                            max = max(china$Date),
                            value = min(china$Date),
                            step = 0.7,
                            animate=
                              animationOptions(interval=300, loop = T,
                                               playButton = "Play", pauseButton = "Stop"))),
  
  leafletOutput("koo_map", width = "100%", height = "100%")
)



server <- function(input, output, session){
  filteredData <- reactive({
    #add rollified thing
    from<- input$animation
    till<- input$animation+1       # calculate one day
    china %>% filter(Date >= from & Date <=  till)
  })
  
  
  output$koo_map <- renderLeaflet({
    #stuff in server

    leaflet() %>%
      addProviderTiles(providers$CartoDB.Positron) %>% # map tile option
      
      setView(lng=109, lat=38, zoom = 4 )
    # addControl(actionButton("zoomer","Reset"),position="topright")
  })
  
  observe({
    
    mnpopup1 <- paste0("<b>","Province: ","</b>", as.character(filteredData()$`Province/State`), "<br>",
                       "<b>","ConFirmed: ","</b>", as.character(filteredData()$Confirmed), "<br>",
                       "<b>", "Deaths: ", "</b>", as.character(filteredData()$Deaths), "<br>",
                       "<b>", "Recovered: ", "</b>", as.character(filteredData()$Recovered), "<br>")
    

    
    leafletProxy(mapId = "koo_map", data = filteredData()) %>%
      clearMarkers() %>%   ## clear previous markers
      clearShapes() %>%
    
      setView(109, lat=38, zoom = 4 ) %>% 
      
      addCircleMarkers(lng = ~Long, lat = ~Lat,
                       popup = mnpopup1,
                       radius = ~sqrt(sqrt(Confirmed))+5, opacity = 0.2, 
                       fillOpacity = 0.2, color= ~pal(Confirmed))
      
      
      # addLegend("bottomright", pal = pal, values = ~Confirmed,
      #           title = "Num of <br> Confirmed",
      #           opacity = 1)
  })
  
  
}

#shinyApp(ui, server)
```  
</div>  

### Countries with deaths reported  


<div class="fold s">
```{r}
temp <- full_latest_grouped %>% 
  dplyr::select(`Country/Region`, Deaths) %>% 
  filter(Deaths>0) %>% arrange(-Deaths)

temp %>% data.frame
```
</div>  




### Countries and Provinces with no recovered cases  

<div class="fold s">
```{r}
temp <- row_latest_grouped %>% 
  filter(Recovered==0) %>% 
  dplyr::select(`Country/Region`, Confirmed, Deaths, Recovered) %>% 
  arrange(-Confirmed)

datatable(temp)
```  
</div>  
[View the Countries and Provinces with no recovered cases](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Countries and Provinces with no recovered cases.html)  

```{r echo=FALSE}
DT::saveWidget(datatable(temp),
               "Countries and Provinces with no recovered cases.html")
```  


```{r echo=TRUE}
# Provinces with no cases recovered

temp <- china_latest_grouped %>% 
  filter(Recovered==0) %>% 
  dplyr::select(`Province/State`, Confirmed, Deaths, Recovered) %>% 
  arrange(-Confirmed)


temp
```  

### Countries and Provinces with no affected case anymore  

<div class="fold s">
```{r}
temp <- row_latest_grouped %>% 
  filter(Confirmed==Deaths+Recovered) %>% 
  dplyr::select(`Country/Region`, Confirmed, Deaths, Recovered) %>% 
  arrange(-Confirmed)


temp %>% data.frame
```  
</div>  

```{r}
temp <- china_latest_grouped %>% 
  filter(Confirmed==Deaths+Recovered) %>% 
  dplyr::select(`Province/State`, Confirmed, Deaths, Recovered) %>% 
  arrange(-Confirmed)


temp %>% data.frame
```  

### Countries and Provinces with all the cases recovered  


<div class="fold s">
```{r}
temp <- row_latest_grouped %>% 
  filter(Confirmed==Recovered) %>% 
  dplyr::select(`Country/Region`, Confirmed, Recovered) %>% 
  arrange(-Confirmed)

temp %>% data.frame
```  
</div>  

```{r}
temp <- china_latest_grouped %>% 
  filter(Confirmed==Recovered) %>% 
  dplyr::select(`Province/State`, Confirmed, Recovered) %>% 
  arrange(-Confirmed)

temp %>% data.frame
```  



### Diamond Princess Cruise ship Status  

<div class="fold s">
```{r}
temp <- ship %>% 
  arrange(Date) %>% 
  tail(1)

temp %>% data.frame
```  
</div>  

<div class="fold s">
```{r}
temp <- ship %>% filter(Date==max(ship$Date))



mnpopup1 <- paste0("<b>","Province: ","</b>", as.character(temp$`Province/State`), "<br>",
                   "<b>","ConFirmed: ","</b>", as.character(temp$Confirmed), "<br>",
              "<b>", "Deaths: ", "</b>", as.character(temp$Deaths), "<br>",
              "<b>", "Recovered: ", "</b>", as.character(temp$Recovered), "<br>")


labs1 <- lapply(seq(nrow(temp)), function(i) {
  paste0( '<b>',"Province: ","</b>" , temp[i, "Province/State"], '<br>',
          '<b>',"ConFirmed: ","</b>" , temp[i, "Confirmed"], '<br>', 
          '<b>',"Deaths: ","</b>", temp[i, "Deaths"], '<br>', 
          '<b>',"Recovered: ","</b>", temp[i, "Recovered"],'<br>') 
})





leaflet(data=temp) %>% addTiles() %>% 
  setView(139.677376, lat=35.442777, zoom = 11 ) %>% 

  addCircleMarkers(data = temp,
                   ~Long, ~Lat, 
                   popup = mnpopup1, label = lapply(labs1, htmltools::HTML),
                   radius = ~17, color = "red") %>% 
  addProviderTiles(providers$CartoDB.Positron)
```
</div>  
[View the Diamond Princess Cruise ship Status map](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/ship.html)  

* The Diamond Princess cruise ship was carrying 3,711 passengers and crew on board  
* Ship arrived in Yokohama, near Tokyo, on February 3  
* <https://www.princess.com/news/notices_and_advisories/notices/diamond-princess-update.html>  



## Hubei - China - World  

<div class="fold s">
```{r}
temp <- full_latest %>% 
  mutate(location = case_when(
    `Country/Region`=="China" & `Province/State`=="Hubei" ~ "Hubei",
    `Country/Region`=="China" & `Province/State`!="Hubei" ~ "Other Chinese Provinces",
    `Country/Region`!="China" & `Province/State` %notin% "Hubei" ~ "Rest of the World"))



temp <- temp %>% group_by(location) %>% summarise(Confirmed=sum(Confirmed),
                                          Deaths=sum(Deaths),
                                          Recovered=sum(Recovered))


temp <- temp %>% gather(key=case,value=val,2:4)



fig <- temp %>% ggplot(aes(x=location, y=val, fill=case)) +
  geom_bar(stat = "identity", position = "dodge") + coord_flip()

#levels 변경해야될까?
ggplotly(fig)
```
</div>  
[View the Hubei - China - World](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Hubei_China_World.html)  

```{r}
DT::saveWidget(ggplotly(fig), "Hubei_China_World.html")
```



## Number of new cases everyday  



```{r}
temp <- china %>% 
  group_by(Date) %>% 
  summarise(Confirmed = sum(Confirmed),
            Deaths = sum(Deaths),
            Recovered = sum(Recovered)) %>% 
  mutate(Confirmed_date = c(min(Confirmed), diff(Confirmed)),
         Deaths_date = c(min(Deaths), diff(Deaths)),
         Recovered_date = c(min(Recovered), diff(Deaths)))


temp <- dplyr::select(temp,-c(2:4))
temp <- rename(temp, Confirmed = Confirmed_date,
               Deaths = Deaths_date,
               Recovered = Recovered_date)

temp <- temp %>% gather(key=Case, value=val,-1)



fig <- temp %>% ggplot(aes(x=Date, y=val, fill=Case)) +
         geom_bar(stat="identity") + ggtitle("Number of new cases in China everyday")
  
ggplotly(fig) %>% 
  layout(hovermode = "x")
```  
[View the Number of new cases everyday in China](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Number of new cases everyday.html)  


```{r echo=FALSE}
DT::saveWidget(ggplotly(fig) %>% 
  layout(hovermode = "x"),
               "Number of new cases everyday.html")
```  



<div class="fold s">
```{r}
temp <- row %>% 
  group_by(Date) %>% 
  summarise(Confirmed = sum(Confirmed),
            Deaths = sum(Deaths),
            Recovered = sum(Recovered)) %>% 
  mutate(Confirmed_date = c(min(Confirmed), diff(Confirmed)),
         Deaths_date = c(min(Deaths), diff(Deaths)),
         Recovered_date = c(min(Recovered), diff(Deaths)))


temp <- dplyr::select(temp,-c(2:4))
temp <- rename(temp, Confirmed = Confirmed_date,
               Deaths = Deaths_date,
               Recovered = Recovered_date)

temp <- temp %>% gather(key=Case, value=val,-1)


fig <- temp %>% ggplot(aes(x=Date, y=val, fill=Case)) +
         geom_bar(stat="identity") + ggtitle("Number of new cases outside China everyday")
  
ggplotly(fig) %>% 
  layout(hovermode = "x")
```
</div>  
[View the Number of new cases everyday outside China](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Number of new cases everyday2.html)  

```{r echo=FALSE}
DT::saveWidget(ggplotly(fig) %>% 
  layout(hovermode = "x"),
               "Number of new cases everyday2.html")
```


2월 7일 확진이 -인것은 뭐지?  


### Number of Cases  

<div class="fold s">
```{r}
temp <- full_table %>% 
          group_by(Date, `Country/Region`) %>% 
          summarise(Confirmed=max(Confirmed),
                    Deaths=max(Deaths),
                    Recovered=max(Recovered)) 


temp <- temp %>% filter(`Country/Region` %in% "China")
temp <- temp %>% gather(key=Case, value=Count, -c(1:2))



fig <- temp %>% ggplot(aes(x=Date, y=Count, fill=Case)) +
        geom_bar(stat="identity") +
        facet_grid(~Case) + 
        theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
        ggtitle("Cases in China") + xlab("")

ggplotly(fig) %>% 
    layout(hovermode = "x")
```
</div>  
[View the Number of Cases in China](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Number of Cases.html)  

```{r echo=FALSE}
DT::saveWidget(ggplotly(fig) %>% 
    layout(hovermode = "x"),
               "Number of Cases.html")
```


<div class="fold s">
```{r}
temp <- full_table %>% 
          group_by(Date, `Country/Region`) %>% 
          summarise(Confirmed=max(Confirmed),
                    Deaths=max(Deaths),
                    Recovered=max(Recovered)) 


temp <- temp %>% filter(`Country/Region` %notin% "China")
temp <- temp %>% gather(key=Case, value=Count, -c(1:2))



fig <- temp %>% ggplot(aes(x=Date, y=Count, fill=Case)) +
        geom_bar(stat="identity") +
        facet_grid(~Case) + 
        theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
        ggtitle("Cases outside China") + xlab("")

ggplotly(fig) %>% 
    layout(hovermode = "x")
```
</div>  
[View the Number of Cases outside China](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Number of Cases2.html)  

```{r}
DT::saveWidget(ggplotly(fig) %>% 
    layout(hovermode = "x"),
               "Number of Cases2.html")
```


## Number of Places to which COVID-19 Spread  

<div class="fold s">
```{r}
spread_china <- china %>% 
  filter(Confirmed!=0) %>% 
  group_by(Date) %>% 
  distinct(`Province/State`) %>% 
  summarise("Province/State"=n())



spread_china %>% ggplot(aes(x=Date, y=`Province/State`)) +
  geom_line(col="blue",lwd=1) +
  scale_y_continuous(breaks=seq(22,31)) +
  scale_x_date(date_breaks = "4 day", 
              labels=date_format("%m-%d"),
              limits = as.Date(c('2020-01-22','2020-02-26'))) +
  ggtitle("Number of Provinces/States/Region of China \n to which COVID-19 spread over the time")
```  
</div>  

<div class="fold s">
```{r}
spread_out <- full_table %>% 
  filter(Confirmed!=0) %>% 
  group_by(Date) %>% 
  distinct(`Country/Region`) %>% 
  summarise("Country/Region"=n())



spread_out %>% ggplot(aes(x=Date, y=`Country/Region`)) +
  geom_line(col="blue",lwd=1) +
  scale_y_continuous(breaks=seq(5,50,5)) +
  scale_x_date(date_breaks = "4 day", 
              labels=date_format("%m-%d"),
              limits = as.Date(c('2020-01-22','2020-02-26'))) +
  ggtitle("Number of Country/Region \n to which COVID-19 spread over the time")
```  
</div>  


* COVID-19 spread to all the provinces of the China really fast and early  
* Number of countries to which COVID-19 spread hasn't increased that much after first few weeks  


## Recovery and Mortality Rate Over The Time  

<div class="fold s">
```{r}
temp <- full_table %>% group_by(Date) %>% summarise(Confirmed=sum(Confirmed),
                                                    Deaths=sum(Deaths),
                                                    Recovered=sum(Recovered))

temp[, "# of Deaths to 100 Confirmed Cases"] <- round(temp[,"Deaths"]/temp[,"Confirmed"],3) * 100
temp[, "# of Recovered to 100 Confirmed Cases"] <- round(temp[,"Recovered"]/temp[,"Confirmed"],3) * 100
temp[, "# of Recovered to 1 Death Cases"] <- round(temp[,"Recovered"]/temp[,"Deaths"],3)

temp <- temp %>% gather(key=Ratio, value=Value, 5:7)



fig <- temp %>% ggplot(aes(x=Date, y=Value, col=Ratio)) + 
          geom_line(lwd=1) +
          ggtitle("Recovery and Mortaliry Rate Over The Time")

ggplotly(fig)
```
</div>  
[View the Recovery and Mortality Rate Over The Time](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Recovery_and_Mortality.html)  


```{r echo=FALSE}
DT::saveWidget(ggplotly(fig),
         "Recovery_and_Mortality.html")
```



* During the first few weeks the there were more Deaths reported per day than Recoverd cases  
* Over the time that has changed drastically  
* Although the death rate hasn't come down, the number of recovered cases has defenitly increased  


## Proportion of Cases  

<div class="fold s">
```{r}
temp <- row_latest %>% 
  group_by(`Country/Region`) %>% 
  summarise(Confirmed=sum(Confirmed),
            Deaths=sum(Deaths),
            Recovered=sum(Recovered)) %>% 
  arrange(-Confirmed)


temp <- temp %>% gather(key=Case, value=Value,-1)

fig <- temp %>% ggplot(aes(x=reorder(`Country/Region`,Value), y=Value, fill=Case)) +
          geom_bar(stat="identity") +
          theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            theme( # remove the vertical grid lines
                   panel.grid.major.x = element_blank() ,
                   # explicitly set the horizontal lines (or they will disappear too)
                   panel.grid.major.y = element_line()) + 
          ggtitle("Number of Cases outside China") + 
          xlab("Country/Region")

ggplotly(fig)
```
</div>  
[View the Proportion of Cases outside China](https://raw.githack.com/koojaekwan/Corona-19/master/html_files/Proportion_of_Cases.html)  


```{r echo=FALSE}
DT::saveWidget(ggplotly(fig),
         "Proportion_of_Cases.html")
```



<div class="fold s">
```{r}
temp <- china_latest %>% 
  group_by(`Province/State`) %>% 
  summarise(Confirmed=sum(Confirmed),
            Deaths=sum(Deaths),
            Recovered=sum(Recovered)) %>% 
  arrange(-Confirmed)


temp <- temp %>% gather(key=Case, value=Value,-1)

fig <- temp %>% ggplot(aes(x=reorder(`Province/State`,Value), y=Value, fill=Case)) +
          geom_bar(stat="identity") +
          coord_flip() +
            theme( # remove the vertical grid lines
                   panel.grid.major.x = element_blank() ,
                   # explicitly set the horizontal lines (or they will disappear too)
                   panel.grid.major.y = element_blank()) + 
          ggtitle("Number of Cases in China") +
          xlab("Province/State")

ggplotly(fig)
```
</div>  
[View the Proportion of Cases in China](https://github.com/koojaekwan/Corona-19/blob/master/html_files/Proportion_of_Cases2.html)  


```{r echo=FALSE}
DT::saveWidget(ggplotly(fig),
               "Proportion_of_Cases2.html")
```



<div class="fold s">
```{r}
treemap(china_latest,
        index = "Province/State",
        vSize = "Confirmed",
        type = "index",
        title="Number of Confirmed Cases in Chinese Provinces")


treemap(china_latest,
        index = "Province/State",
        vSize = "Deaths",
        type = "index",
        title="Number of Deaths Reported in Chinese Provinces")


treemap(china_latest,
        index = "Province/State",
        vSize = "Recovered",
        type = "index",
        title="Number of Recovered Cases in Chinese Provinces")


treemap(row_latest,
        index = "Country/Region",
        vSize = "Confirmed",
        type = "index",
        title="Number of Confirmed Cases outside China")



treemap(row_latest,
        index = "Country/Region",
        vSize = "Deaths",
        type = "index",
        title="Number of Deaths Reported outside China")


treemap(row_latest,
        index = "Country/Region",
        vSize = "Recovered",
        type = "index",
        title="Number of Recovered Cases outside China")
```  
</div>  




## Number of cases  

```{r}
temp <- china %>% group_by(Date) %>% summarise(Confirmed=sum(Confirmed),
                                               Deaths=sum(Deaths),
                                               Recovered=sum(Recovered)) 


temp <- temp %>% gather(key=Cases, value=val, 2:4)


temp %>% ggplot(aes(x=Date, y=val, col=Cases)) + 
  geom_line(lwd=1) + 
  theme_classic() +
  theme(legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        legend.position = c(0.15, 0.8))
```  

```{r}
temp <- row %>% group_by(Date) %>% summarise(Confirmed=sum(Confirmed),
                                     Deaths=sum(Deaths),
                                     Recovered=sum(Recovered)) 

temp <- temp %>% gather(key=Cases, value=val, 2:4)

temp %>% ggplot(aes(x=Date, y=val, col=Cases)) + 
  geom_line(lwd=1) + 
  theme_classic() +
  theme(legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"),
        legend.position = c(0.15, 0.8))
```  

## Number of new cases  

```{r}
temp <- full_table %>% group_by(`Country/Region`,Date) %>% 
  summarise(Confirmed=sum(Confirmed),
            Deaths=sum(Deaths),
            Recovered=sum(Recovered)) %>% 
  filter(Confirmed!=0)
```  

## Number of Countries with new cases  

```{r}
temp_c <- temp %>% group_by(Date) %>% summarise(n=n())

ggplot(temp_c, aes(x=Date, y=n)) + 
  geom_line(col="blue", lwd=1) + 
  theme_classic() +
  theme(legend.background = element_rect(fill="white",
                                  size=0.5, linetype="solid", 
                                  colour ="black"))
  
```  


```{r}
# Number of new Countries
temp_c <- temp %>% group_by(Date) %>% summarise(n=n()) %>% mutate("Number of new Countries"=c(min(n),diff(n)))


ggplot(temp_c, aes(x=Date, y=`Number of new Countries`)) + 
  geom_bar(stat="identity", fill="skyblue") + 
  theme_classic() + 
  scale_y_continuous(breaks=seq(0,8,1)) +
  scale_x_date(date_breaks = "1 day", 
              labels=date_format("%m-%d"),
              limits = as.Date(c('2020-01-21','2020-02-27'))) +
  ggtitle("Number of new Countries") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```  




## refer  

* [treemap]<https://www.r-graph-gallery.com/236-custom-your-treemap.html>  


* [date range in ggplot]<https://stackoverflow.com/questions/14162829/set-date-range-in-ggplot>  

* [Multi popup in leaflet]<https://www.nickconti.io/interactive_election_R.html>  
* [Multi label in leaflet]<https://stackoverflow.com/questions/43144596/r-and-leaflet-how-to-arrange-label-text-across-multiple-lines>  
* [leaflet tiles]<https://rstudio.github.io/leaflet/basemaps.html>  

* [How to add code folding]<https://stackoverflow.com/questions/37755037/how-to-add-code-folding-to-output-chunks-in-rmarkdown-html-documents>  


### What i have to study later.  

* [treemap plotly]<https://plot.ly/r/treemaps/>  - i don't know well. is it possible?  

* [bar chart on the leaflet map]<https://stackoverflow.com/questions/45538831/creating-a-leaflet-map-with-custom-labels-in-r>  

* [Cumulative Lines Animation with ggplot2]<https://plot.ly/ggplot2/cumulative-animations/>  

